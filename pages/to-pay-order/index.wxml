<block wx:if="{{ bindMobileStatus == 2 }}">
  <view class="bind-mobile-container">
    <view class="bind-mobile-card">
      <view class="card-icon">
        <view class="icon-shield">
          <view class="shield-inner"></view>
        </view>
      </view>
      <view class="card-title">è¯·å…ˆç™»å½•</view>
      <view class="card-subtitle">ä¸ºäº†ä¿éšœæ‚¨çš„äº¤æ˜“å®‰å…¨å’Œè®¢å•ä¿¡æ¯å‡†ç¡®</view>
      <view class="feature-list">
        <view class="feature-item">
          <view class="feature-dot"></view>
          <text class="feature-text">æ¥æ”¶è®¢å•ç‰©æµä¿¡æ¯</text>
        </view>
        <view class="feature-item">
          <view class="feature-dot"></view>
          <text class="feature-text">ä¿éšœè´¦æˆ·èµ„é‡‘å®‰å…¨</text>
        </view>
        <view class="feature-item">
          <view class="feature-dot"></view>
          <text class="feature-text">æä¾›ä¸“å±å”®åæœåŠ¡</text>
        </view>
      </view>
      <view class="bind-btn-wrapper">
        <button class="bind-btn" bind:tap="bindMobile">
          <text class="bind-btn-text">æ‰‹æœºå·å¿«æ·ç™»å½•</text>
        </button>
      </view>
      <view class="security-tips">
        <view class="tips-icon">ğŸ”’</view>
        <text class="tips-text">æ‚¨çš„ä¿¡æ¯å°†è¢«åŠ å¯†ä¿æŠ¤ï¼Œç»ä¸æ³„éœ²ç»™ç¬¬ä¸‰æ–¹</text>
      </view>
    </view>
  </view>
</block>
<block wx:if="{{ bindMobileStatus == 1 }}">
  <block wx:if="{{ orderType != 'buyNow' }}"> <!-- è´­ç‰©è½¦ -->
    <van-cell-group wx:for="{{shopList}}" wx:for-item="shop" wx:for-index="shopIndex" wx:key="id" title="{{ shop.name }}">
      <van-card
        wx:for="{{goodsList}}" wx:key="index"
        wx:if="{{ item.shopId == shop.id }}"
        num="{{item.number}}"
        price="{{item.price}}"
        title="{{item.name}}"
        thumb="{{ item.pic }}"
        centered
        >
        <view slot="desc">
          {{item.label}}
          <block wx:for="{{item.sku}}" wx:for-item="option" wx:key="index">
            {{option.optionName}}:{{option.optionValueName}}
          </block>
          <block wx:for="{{item.additions}}" wx:for-item="option" wx:key="index">
            {{option.pname}}:{{option.name}}
          </block>
        </view>
      </van-card>
      <view class="peisong-way" hidden="{{ shop.hasNoCoupons }}">
        <view class="row-box" style="border-bottom:none;">
          <view class="row-label t">ä½¿ç”¨ä¼˜æƒ åˆ¸</view>
        </view>
        <picker data-sidx="{{ shopIndex }}" bindchange="bindChangeCouponShop" range="{{ shop.coupons }}" range-key="nameExt">
          <view class="row-box" style="border-bottom:none;">      
            <view class="row-label">{{ shop.curCouponShowText }}</view>
            <image class="next" src="/images/icon/next.png"></image>
          </view>
        </picker>
      </view>
    </van-cell-group>
  </block>
  <block wx:else> <!-- ç«‹å³è´­ä¹° -->
    <van-card
      wx:for="{{goodsList}}" wx:key="index"
      num="{{item.number}}"
      price="{{item.price}}"
      title="{{item.name}}"
      thumb="{{ item.pic }}"
      centered
      >
      <view slot="desc">
        {{item.label}}
        <block wx:for="{{item.sku}}" wx:for-item="option" wx:key="index">
          {{option.optionName}}:{{option.optionValueName}}
        </block>
        <block wx:for="{{item.additions}}" wx:for-item="option" wx:key="index">
          {{option.pname}}:{{option.name}}
        </block>
      </view>
    </van-card>
  </block>
  <view class="container-box cell-group">
    <view class="peisong-way">
      <van-cell wx:if="{{shopCarType == 0 && isNeedLogistics > 0}}" title="é…é€æ–¹å¼">
        <view slot="">
          <radio-group bindchange="radioChange">
            <label class="radio">
              <radio value="kd" checked="{{peisongType == 'kd'}}" /> å¿«é€’
            </label>
            <label class="radio">
              <radio value="zq" checked="{{peisongType == 'zq'}}" /> åˆ°åº—è‡ªå–
            </label>
          </radio-group>
        </view>
      </van-cell>
      <van-cell wx:if="{{shopCarType == 1}}" title="é…é€åœ°å€" />
      <picker wx:if="{{peisongType == 'zq' && shops}}" bindchange="shopSelect" value="{{shopIndex}}" range="{{shops}}" range-key="name">
        <van-cell title="é€‰æ‹©è‡ªæé—¨åº—" value="{{shopIndex == -1 ? 'è¯·é€‰æ‹©':shops[shopIndex].name}}" required is-link />
      </picker>
      <van-cell wx:if="{{peisongType == 'zq' && shopIndex != -1}}" title="ç”µè¯" value="{{shops[shopIndex].linkPhone}}" is-link bind:click="callMobile" />
      <van-cell wx:if="{{peisongType == 'zq' && shopIndex != -1}}" title="åœ°å€" title-width="64rpx" value="{{shops[shopIndex].address}}" is-link bind:click="goMap" />
      
      <!-- åœ°å€é€‰æ‹©åŒºåŸŸ -->
      <view class="address-box" wx:if="{{peisongType == 'kd' && isNeedLogistics > 0}}">
        <!-- å¦‚æœæ²¡æœ‰åœ°å€ï¼Œåªæ˜¾ç¤ºæ–°å¢åœ°å€ -->
        <van-cell wx:if="{{addressList.length == 0}}" icon="add-o" title="æ–°å¢æ”¶è´§åœ°å€" is-link bind:click="addAddress" />
        
        <!-- å¦‚æœæœ‰åœ°å€ï¼Œæ˜¾ç¤ºåœ°å€åˆ—è¡¨ -->
        <van-cell-group wx:if="{{addressList.length > 0}}">
          <van-radio-group value="{{ curAddressData ? curAddressData.id : '' }}" bind:change="onAddressChange">
            <van-cell 
              wx:for="{{ addressList }}" 
              wx:key="id" 
              clickable
              data-index="{{ index }}"
              bind:click="onSelectAddressInline"
              custom-class="address-cell-item"
            >
              <view slot="title" class="address-item-inline">
                <view class="address-header-inline">
                  <text class="address-name-inline">{{ item.linkMan }}</text>
                  <text class="address-mobile-inline">{{ item.mobile }}</text>
                  <text wx:if="{{ item.isDefault }}" class="default-tag-inline">é»˜è®¤</text>
                </view>
                <view class="address-detail-inline">
                  {{ item.provinceName }} {{ item.cityName }} {{ item.districtName }} {{ item.streetName }}
                </view>
                <view class="address-full-inline">{{ item.address }}</view>
              </view>
              <van-radio slot="right-icon" name="{{ item.id }}" />
            </van-cell>
          </van-radio-group>
          
          <!-- æ–°å¢åœ°å€æŒ‰é’® -->
          <van-cell icon="add-o" title="æ–°å¢å…¶ä»–åœ°å€" is-link bind:click="addAddress" />
        </van-cell-group>
      </view>
      <van-field
        wx:if="{{peisongType == 'zq'}}"
        size="large"
        model:value="{{ name }}"
        label="è”ç³»äºº"
        clearable
        required
        placeholder="è¯·è¾“å…¥è”ç³»äºº"
      />
      <van-field
        wx:if="{{peisongType == 'zq'}}"
        size="large"
        model:value="{{ mobile }}"
        label="è”ç³»ç”µè¯"
        type="number"
        clearable
        required
        placeholder="è¯·è¾“å…¥æ‰‹æœºå·ç ">
        <!-- <van-button slot="button" size="small" type="danger" bind:tap="bindMobile">è‡ªåŠ¨è·å–</van-button> -->
      </van-field>
      <block wx:if="{{ extRequired && extRequired.length > 0 }}">
        <van-field
          wx:for="{{ extRequired }}" wx:key="*this"
          size="large"
          label="{{ item }}"
          required
          placeholder="è¯·è¾“å…¥{{ item }}"
          data-name="{{ item }}"
          bind:change="extRequiredChange"
        />
      </block>
      <view wx:if="{{shopCarType == 0}}" class="row-box">
        <view class="row-label">å¤‡æ³¨</view>
        <view class="right-text">
          <input bindinput="remarkChange" type="text" class="liuyan" placeholder="å¦‚éœ€å¤‡æ³¨è¯·è¾“å…¥" />
        </view>
      </view>
      <van-cell wx:if="{{ orderPeriod_open == 1 }}" title="è®¢é˜…">
        <view slot="">
          <radio-group bindchange="dyChange">
            <label class="radio">
              <radio value="1" checked="{{ dyopen == 1 }}" /> å¼€å¯
            </label>
            <label class="radio">
              <radio value="0" checked="{{ dyopen == 0 }}" /> å…³é—­
            </label>
          </radio-group>
        </view>
      </van-cell>
      <van-cell wx:if="{{ dyopen == 1 }}" title="è®¢é˜…å‘¨æœŸ">
        <view slot="">
          <radio-group bindchange="dyunitChange">
            <label class="radio">
              <radio value="0" checked="{{ dyunit == 0 }}" /> å¤©
            </label>
            <label class="radio">
              <radio value="1" checked="{{ dyunit == 1 }}" /> æœˆ
            </label>
            <label class="radio">
              <radio value="2" checked="{{ dyunit == 2 }}" /> å¹´
            </label>
          </radio-group>
        </view>
      </van-cell>
      <van-field
        wx:if="{{ dyopen == 1 }}"
        label="è®¢é˜…é—´éš”"
        model:value="{{ dyduration }}"
        type="number"
        placeholder="è¯·è¾“å…¥æ•°å­—"
        input-align="right"
        use-button-slot
      >
        <view slot="button">
          {{ dyunit == 0 ? 'å¤©': '' }}
          {{ dyunit == 1 ? 'æœˆ': '' }}
          {{ dyunit == 2 ? 'å¹´': '' }}
        </view>
      </van-field>
      <van-field
        wx:if="{{ dyopen == 1 }}"
        label="è®¢é˜…æ¬¡æ•°"
        model:value="{{ dytimes }}"
        type="number"
        placeholder="è¯·è¾“å…¥æ•°å­—"
        input-align="right"
        use-button-slot
      >
        <view slot="button">æ¬¡</view>
      </van-field>
      <van-field
        wx:if="{{ dyopen == 1 }}"
        label="é¦–æ¬¡æ‰£è´¹"
        is-link
        readonly
        value="{{ dateStart }}"
        type="number"
        placeholder="è¯·è¾“å…¥æ•°å­—"
        input-align="right"
        bind:click-input="dateStartclick"
      />
    </view>
    <view class="peisong-way" hidden="{{hasNoCoupons}}">
      <view class="row-box" style="border-bottom:none;">
        <view class="row-label t">ä½¿ç”¨ä¼˜æƒ åˆ¸</view>
      </view>
      <picker bindchange="bindChangeCoupon" range="{{coupons}}" range-key="nameExt">
        <view class="row-box" style="border-bottom:none;">      
          <view class="row-label">{{curCouponShowText}}</view>
          <image class="next" src="/images/icon/next.png"></image>
        </view>
      </picker>
    </view>
  </view>

  <!-- é€‰æ‹©ç§¯åˆ†æŠµæ‰£ -->
  <van-radio-group wx:if="{{ scoreDeductionRules && scoreDeductionRules.length > 0 }}" value="{{ deductionScore }}" bind:change="deductionScoreChange">
    <van-cell-group title="ç§¯åˆ†æŠµæ‰£">
      <van-cell title="ä¸ä½¿ç”¨ç§¯åˆ†" clickable data-name="-1" bind:click="deductionScoreClick">
        <van-radio slot="right-icon" name="-1" />
      </van-cell>
      <van-cell title="è‡ªåŠ¨æŠµæ‰£" clickable data-name="0" bind:click="deductionScoreClick">
        <van-radio slot="right-icon" name="0" />
      </van-cell>
      <van-cell wx:for="{{scoreDeductionRules}}" wx:key="id" title="ä½¿ç”¨{{ item.score }}ç§¯åˆ†æŠµæ‰£Â¥{{ item.money }}" clickable data-name="{{ item.score }}" bind:click="deductionScoreClick">
        <van-radio slot="right-icon" name="{{ item.score }}" />
      </van-cell>
    </van-cell-group>
  </van-radio-group>

  <van-radio-group wx:if="{{ myCards }}" value="{{ cardId }}" bind:change="cardChange">
    <van-cell-group title="ä½¿ç”¨æ°´å¡æ”¯ä»˜">
      <van-cell title="ä¸ä½¿ç”¨æ°´å¡" clickable data-name="0" bind:click="cardClick">
        <van-radio slot="right-icon" name="0" />
      </van-cell>
      <van-cell wx:for="{{ myCards }}" wx:key="id" title="{{ item.cardInfo.name }} - å‰©ä½™ï¼š{{ item.amount }}æ¡¶" clickable data-name="{{ item.id }}" bind:click="cardClick">
        <van-radio slot="right-icon" name="{{ item.id }}" />
      </van-cell>
    </van-cell-group>
  </van-radio-group>

  <van-cell-group wx:if="{{ yunPrice || deductionMoney || couponAmount || balance }}" title="å°è®¡">
    <van-cell wx:if="{{ yunPrice }}" title="è¿è´¹" value="Â¥{{yunPrice}}" />
    <van-cell wx:if="{{ amountLogistics2 }}" title="é™„åŠ è¿è´¹" value="Â¥{{ amountLogistics2 }}" />
    <block wx:if="{{ goodsAdditionalPriceMap }}">
      <van-cell
        wx:for="{{ goodsAdditionalPriceMap }}" wx:key="id"
        title="{{ index }}"
        value="Â¥{{ item }}"
      />
    </block>
    <van-cell wx:if="{{deductionMoney}}" title="ç§¯åˆ†æŠµæ‰£" value="-Â¥{{deductionMoney}}" />
    <van-cell wx:if="{{couponAmount}}" title="ä¼˜æƒ é‡‘é¢" value="-Â¥{{couponAmount}}" />
    <van-cell wx:if="{{order_pay_user_balance == '1' && balance}}" title="è´¦æˆ·ä½™é¢" value="Â¥{{balance}}" />
    <van-cell wx:if="{{order_pay_user_balance == '1' && userScore}}" title="å¯ç”¨ç§¯åˆ†" value="{{userScore}}" />
  </van-cell-group>
  <view class="bottom-box"></view>
  <van-submit-bar
    wx:if="{{ yunPrice >= 99999 }}"
    price="{{ (allGoodsAndYunPrice - yunPrice)*100 }}"
    suffix-label="{{ totalScoreToPay ? '+' + totalScoreToPay + ' ç§¯åˆ†' : '' }}"
    button-text="è¯¥åœ°åŒºç¦å”®"
    disabled
  />
  <van-submit-bar
    wx:else
    price="{{ allGoodsAndYunPrice*100 }}"
    suffix-label="{{ totalScoreToPay ? '+' + totalScoreToPay + ' ç§¯åˆ†' : '' }}"
    button-text="æäº¤è®¢å•"
    loading="{{ btnLoading }}"
    bind:submit="goCreateOrder"
  />
</block>

<van-popup
  show="{{ dateStartpop }}"
  position="bottom"
>
  <van-datetime-picker
    type="datetime"
    value="{{ currentDate }}"
    min-date="{{ minDate }}"
    max-date="{{ maxDate }}"
    formatter="{{ formatter }}"
    bind:confirm="dateStartconfirm"
    bind:cancel="dateStartcancel"
  />
</van-popup>

<bind-mobile
  title="ç»‘å®šæ‰‹æœºå·ç "
  alarmText="ä¸ºä¿éšœæ‚¨çš„èµ„é‡‘å®‰å…¨ï¼Œè¯·å…ˆç»‘å®šæ‰‹æœºå·ç "
  show="{{ bindMobileShow }}"
  bind:cancel="bindMobileCancel"
  bind:ok="bindMobileOk"
/>

<payment
  money="{{ money }}"
  remark="æ”¯ä»˜è®¢å• ï¼š{{ orderId }}"
  nextAction="{{ nextAction }}"
  show="{{ paymentShow }}"
  bind:cancel="paymentCancel"
  bind:ok="paymentOk"
/>

<!-- åœ°å€é€‰æ‹©å¼¹çª— -->
<van-popup show="{{ showAddressSelector }}" position="bottom" bind:close="closeAddressSelector" closeable round>
  <view class="address-selector-popup">
    <view class="popup-title">é€‰æ‹©æ”¶è´§åœ°å€</view>
    <van-radio-group value="{{ curAddressData ? curAddressData.id : '' }}">
      <van-cell-group>
        <van-cell 
          wx:for="{{ addressList }}" 
          wx:key="id" 
          clickable
          data-index="{{ index }}"
          bind:click="onSelectAddress"
        >
          <view slot="title" class="address-item">
            <view class="address-header">
              <text class="address-name">{{ item.linkMan }}</text>
              <text class="address-mobile">{{ item.mobile }}</text>
              <text wx:if="{{ item.isDefault }}" class="default-tag">é»˜è®¤</text>
            </view>
            <view class="address-detail">
              <text class="address-region">{{ item.provinceName }} {{ item.cityName }} {{ item.districtName }} {{ item.streetName }}</text>
            </view>
            <view class="address-full">{{ item.address }}</view>
          </view>
          <van-radio slot="right-icon" name="{{ item.id }}" />
        </van-cell>
      </van-cell-group>
    </van-radio-group>
    <view class="add-new-address">
      <van-button type="primary" size="large" bind:click="addAddress" block>æ–°å¢æ”¶è´§åœ°å€</van-button>
    </view>
  </view>
</van-popup>