<view class="page-container">
  <!-- å¤´éƒ¨ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
  <view class="header-section">
    <view wx:if="{{ !apiUserInfoMap }}" class="login-container">
      <view class="login-tips">æ¬¢è¿æ¥åˆ°å•†åŸ</view>
      <view class="login-btn" bindtap="login">
        <text>ç«‹å³ç™»å½•</text>
      </view>
    </view>
    
    <view wx:else class="user-info-container">
      <view class="user-main">
        <button class="avatar-btn" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
          <image class="avatar" src="{{ apiUserInfoMap.base.avatarUrl ? apiUserInfoMap.base.avatarUrl : '/images/default.png' }}" mode="aspectFill"></image>
          <view class="avatar-border"></view>
        </button>
        <view class="user-detail">
          <view class="nickname-row">
            <text class="nickname" bindtap="editNick">{{ apiUserInfoMap.base.nick ? apiUserInfoMap.base.nick : 'ç‚¹å‡»è®¾ç½®æ˜µç§°' }}</text>
            <view wx:if="{{ apiUserInfoMap.userLevel }}" class="user-level">
              <text class="level-icon">ğŸ‘‘</text>
              <text class="level-text">{{ apiUserInfoMap.userLevel.name }}</text>
            </view>
          </view>
          <view class="user-id" bind:tap="copyUid">ID: {{ apiUserInfoMap.base.id }}</view>
        </view>
      </view>
      <view class="qr-code-btn" bindtap="goUserCode">
        <view class="qr-icon-box">
          <van-icon name="qr" size="52rpx" color="#E4393C" />
        </view>
        <view class="qr-text">ä¼šå‘˜ç </view>
      </view>
    </view>
  </view>

  <!-- èµ„äº§å¡ç‰‡ -->
  <view class="asset-card">
    <view class="asset-wrapper">
      <view class='asset-item asset-primary' bindtap='goAsset'>
        <view class="asset-label">ä½™é¢(å…ƒ)</view>
        <view class="asset-amount-row">
          <text class="asset-symbol">Â¥</text>
          <text class="asset-amount">{{balance}}</text>
        </view>
      </view>
      <view class='asset-item asset-secondary' bindtap='goAsset'>
        <view class="asset-label">å†»ç»“(å…ƒ)</view>
        <view class="asset-amount-row">
          <text class="asset-symbol">Â¥</text>
          <text class="asset-amount">{{freeze}}</text>
        </view>
      </view>
    </view>
    <view class="asset-divider"></view>
    <view class="asset-wrapper">
      <view class='asset-item' bindtap='goScore'>
        <view class="asset-amount">{{score}}</view>
        <view class="asset-label">ç§¯åˆ†</view>
      </view>
      <view class='asset-item' bindtap="gogrowth">
        <view class="asset-amount">{{growth}}</view>
        <view class="asset-label">æˆé•¿å€¼</view>
      </view>
    </view>
  </view>

  <!-- ä¼šå‘˜å¡åŒºåŸŸ -->
  <view wx:if="{{ myCards }}" class="card-section">
    <view class="section-title">
      <text class="title-text">æˆ‘çš„ä¼šå‘˜å¡</text>
      <text class="title-icon">ğŸ’³</text>
    </view>
    <view class="card-list {{ cardsExpanded ? 'expanded' : 'collapsed' }}">
      <navigator wx:for="{{ cardsExpanded ? myCards : [myCards[0]] }}" wx:key="id" url="/pages/card/logs?id={{ item.id }}" class="card-item card-item-animate">
        <view class="card-gradient">
          <view class="card-header">
            <view class="card-name">{{ item.cardInfo.name }}</view>
            <view class="card-badge">VIP</view>
          </view>
          <view class="card-body">
            <view class="card-amount-box">
              <text class="card-amount-label">å‰©ä½™æ¬¡æ•°</text>
              <text class="card-amount-value">{{ item.amount }}</text>
            </view>
          </view>
          <view class="card-footer">
            <view class="card-expire">
              <text class="expire-icon">â°</text>
              <text>{{ item.dateEnd }} åˆ°æœŸ</text>
            </view>
            <view class="card-arrow">æŸ¥çœ‹è¯¦æƒ… â€º</view>
          </view>
        </view>
      </navigator>
    </view>
    <view wx:if="{{ myCards.length > 1 }}" class="toggle-btn" bindtap="toggleCards">
      <text class="toggle-text">{{ cardsExpanded ? 'æ”¶èµ·' : 'æŸ¥çœ‹æ›´å¤š(' + (myCards.length - 1) + ')' }}</text>
      <text class="toggle-icon {{ cardsExpanded ? 'rotated' : '' }}">â€º</text>
    </view>
  </view>

  <!-- è®¢å•åŒºåŸŸ -->
  <view class="order-section">
    <view class="section-header">
      <view class="section-title">æˆ‘çš„è®¢å•</view>
      <navigator url="/pages/order-list/index" class="more-link">
        <text>æŸ¥çœ‹å…¨éƒ¨</text>
        <text class="arrow">â€º</text>
      </navigator>
    </view>
    <view class="order-grid">
      <view class="order-item" bindtap='goOrder' data-type="0">
        <view class="order-icon-wrapper">
          <text class="order-icon">ğŸ’°</text>
          <view wx:if="{{count_id_no_pay}}" class="order-badge">{{count_id_no_pay}}</view>
        </view>
        <view class="order-label">å¾…ä»˜æ¬¾</view>
      </view>
      <view class="order-item" bindtap='goOrder' data-type="1">
        <view class="order-icon-wrapper">
          <text class="order-icon">ğŸ“¦</text>
          <view wx:if="{{count_id_no_transfer}}" class="order-badge">{{count_id_no_transfer}}</view>
        </view>
        <view class="order-label">å¾…å‘è´§</view>
      </view>
      <view class="order-item" bindtap='goOrder' data-type="2">
        <view class="order-icon-wrapper">
          <text class="order-icon">ğŸšš</text>
          <view wx:if="{{count_id_no_confirm}}" class="order-badge">{{count_id_no_confirm}}</view>
        </view>
        <view class="order-label">å¾…æ”¶è´§</view>
      </view>
      <view class="order-item" bindtap='goOrder' data-type="3">
        <view class="order-icon-wrapper">
          <text class="order-icon">â­</text>
          <view wx:if="{{count_id_no_reputation}}" class="order-badge">{{count_id_no_reputation}}</view>
        </view>
        <view class="order-label">å¾…è¯„ä»·</view>
      </view>
      <view class="order-item" bindtap='goOrder' data-type="99">
        <view class="order-icon-wrapper">
          <text class="order-icon">ğŸ› </text>
        </view>
        <view class="order-label">å”®å</view>
      </view>
    </view>
  </view>


  <!-- å¸¸ç”¨åŠŸèƒ½ -->
  <view class="function-section">
    <view class="section-title">å¸¸ç”¨åŠŸèƒ½</view>
    <view class="function-grid">
      <navigator url="/pages/goods/his" class="function-item">
        <text class="function-icon">ğŸ“‹</text>
        <view class="function-label">å†å²è´­ä¹°</view>
      </navigator>
      <view wx:if="{{canHX}}" class="function-item" bind:click="scanOrderCode">
        <text class="function-icon">ğŸ“·</text>
        <view class="function-label">æ‰«ç æ ¸é”€</view>
      </view>
      <navigator url="/subpackages/more/asset/index" class="function-item">
        <text class="function-icon">ğŸ“Š</text>
        <view class="function-label">èµ„é‡‘æ˜ç»†</view>
      </navigator>
      <navigator url="/subpackages/more/coupons/index" class="function-item">
        <text class="function-icon">ğŸ«</text>
        <view class="function-label">ä¼˜æƒ åˆ¸</view>
      </navigator>
      <navigator url="/pages/select-address/index" class="function-item">
        <text class="function-icon">ğŸ“</text>
        <view class="function-label">æ”¶è´§åœ°å€</view>
      </navigator>
    </view>
  </view>


  <!-- å…¶ä»–åŠŸèƒ½ -->
  <view class="other-section">
    <view class="section-title">å…¶ä»–åŠŸèƒ½</view>
    <navigator url="/subpackages/more/my/info-menu" class="menu-item">
      <view class="menu-label">ä¸ªäººä¿¡æ¯</view>
      <text class="arrow">â€º</text>
    </navigator>
    <navigator url="/subpackages/more/help/index" class="menu-item">
      <view class="menu-label">å¸®åŠ©ä¸­å¿ƒ</view>
      <text class="arrow">â€º</text>
    </navigator>
    <view wx:if="{{ customerServiceType == 'QW' }}" class="menu-item" bind:click="customerService">
      <view class="menu-label">è”ç³»å®¢æœ</view>
      <text class="arrow">â€º</text>
    </view>
    <navigator url="/subpackages/more/my/setting" class="menu-item">
      <view class="menu-label">ç³»ç»Ÿè®¾ç½®</view>
      <text class="arrow">â€º</text>
    </navigator>
  </view>
</view>

<!-- ä¿®æ”¹æ˜µç§°å¼¹çª— -->
<view wx:if="{{ nickShow }}" class="modal-mask">
  <view class="modal-content" catchtap="">
    <view class="modal-header">ä¿®æ”¹æ˜µç§°</view>
    <view class="modal-body">
      <input class="nick-input" model:value="{{ nick }}" type="nickname" placeholder="è¯·è¾“å…¥æ˜µç§°" placeholder-class="input-placeholder" />
    </view>
    <view class="modal-footer">
      <view class="modal-btn cancel-btn" catchtap="hideNickModal">å–æ¶ˆ</view>
      <view class="modal-btn confirm-btn" catchtap="_editNick">ç¡®å®š</view>
    </view>
  </view>
</view>
