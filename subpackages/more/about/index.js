const WXAPI = require('apifm-wxapi')

// 隐私政策内容
const PRIVACY_POLICY = {
  title: '隐私保护指引',
  content: `<div class="protocol-content">
<h2>连氏散养土鸡 小程序隐私保护指引</h2>

<p>本指引是连氏散养土鸡小程序开发者 监利市连记家禽经营部(个体工商户)（以下简称"开发者"）为处理你的个人信息而制定。</p>

<h3>1. 开发者处理的信息</h3>
<p>根据法律规定，开发者仅处理实现小程序功能所必要的信息。</p>

<p>开发者将在获取你的明示同意后，使用你的相册（仅写入）权限，用途是【保存商品图片、保存商品视频】</p>

<p>开发者将在获取你的明示同意后，收集你的手机号，用途是【订单发货与登录使用】</p>

<p>开发者将在获取你的明示同意后，收集你的位置信息，用途是【添加收货地址用于订单发货,导航农庄自取】</p>

<p>开发者收集你选中的文件，用于上传商品图片。</p>

<p>开发者收集你选中的照片或视频信息，用于上传商品图片、上传商品视频。</p>

<p>开发者  收集你的地址，用于填写收货地址。</p>

<p>开发者  读取你的剪切板，用于复制收货地址、粘贴收货地址。</p>

<p>开发者  获取你选择的位置信息，用于添加收货地址用于订单发货,导航农庄自取。</p>

<h3>2. 第三方插件信息/SDK信息</h3>
<p>为实现特定功能，开发者可能会接入由第三方提供的插件/SDK。第三方插件/SDK的个人信息处理规则，请以其公示的官方说明为准。连氏散养土鸡小程序接入的第三方插件信息/SDK信息如下：</p>

<p><strong>插件名称：</strong>ezplayer</p>
<p><strong>插件提供方名称:</strong> 杭州萤石网络股份有限公司</p>

<p>为了设备预览、回放时，截图后，进行图片的本地保存；体验云录制功能时，存储云录制文件至您的相册，开发者将在获得你的明示同意后，使用你的相册（仅写入）权限。</p>

<p>为了设备对讲时，完成手机端的声音采集；向设备下发语音播报时，完成下发语音片段的采集，开发者将在获得你的明示同意后，访问你的摄像头。</p>

<p>为了设备对讲时，完成手机端的声音采集；向设备下发语音播报时，完成下发语音片段的采集，开发者将在获得你的明示同意后，访问你的麦克风。</p>

<p>开发者调用你的方向传感器，用于手机旋转时，对视频进行自适应全屏。</p>

<p>开发者收集你选中的照片或视频信息，用于设备视频录制后，上传至萤石云控制台。</p>

<h3>3. 未成年人保护</h3>
<p>根据相关法律法规的规定，若你是14周岁以下的未成年人，你需要和你的监护人共同仔细阅读本指引，并在征得监护人明示同意后继续使用小程序服务。开发者将根据相关法律法规的规定及本指引内容，处理经监护人同意而收集的未成年人用户信息，并通过【本指引你的权益部分】披露的内容保障未成年人在个人信息处理活动中的各项权利。</p>

<h3>4. 你的权益</h3>
<p>4.1 关于使用你的相册（仅写入）权限、收集你的位置信息、获取你选择的位置信息，你可以通过以下路径：小程序主页右上角"…"—"设置"—点击特定信息—点击"不允许"，撤回对开发者的授权。</p>

<p>4.2 关于收集你的手机号、收集你选中的文件、收集你选中的照片或视频信息、收集你的地址、读取你的剪切板，你可以通过以下路径：小程序主页右上角"..." — "设置" — "小程序已获取的信息" — 点击特定信息 — 点击"通知开发者删除"，开发者承诺收到通知后将删除信息。法律法规另有规定的，开发者承诺将停止除存储和采取必要的安全保护措施之外的处理。</p>

<p>4.3 关于你的个人信息，你可以通过以下方式与开发者联系，行使查阅、复制、更正、删除等法定权利。</p>

<p>4.4 若你在小程序中注册了账号，你可以通过以下方式与开发者联系，申请注销你在小程序中使用的账号。在受理你的申请后，开发者承诺在十五个工作日内完成核查和处理，并按照法律法规要求处理你的相关信息。</p>

<p><strong>电话:</strong>18957185335</p>

<h3>5. 开发者对信息的存储</h3>
<p>5.1 开发者承诺，除法律法规另有规定外，开发者对你的信息的保存期限应当为实现处理目的所必要的最短时间。</p>

<h3>6. 信息的使用规则</h3>
<p>6.1 开发者将会在本指引所明示的用途内使用收集的信息</p>

<p>6.2 如开发者使用你的信息超出本指引目的或合理范围，开发者必须在变更使用目的或范围前，再次以短信方式告知并征得你的明示同意。</p>

<h3>7. 信息对外提供</h3>
<p>7.1 开发者承诺，不会主动共享或转让你的信息至任何第三方，如存在确需共享或转让时，开发者应当直接征得或确认第三方征得你的单独同意。</p>

<p>7.2 开发者承诺，不会对外公开披露你的信息，如必须公开披露时，开发者应当向你告知公开披露的目的、披露信息的类型及可能涉及的信息，并征得你的单独同意。</p>

<h3>8. 投诉建议</h3>
<p>你认为开发者未遵守上述约定，或有其他的投诉建议、或未成年人个人信息保护相关问题，可通过以下方式与开发者联系；或者向微信进行投诉。</p>
<p><strong>电话:</strong> 18957185335</p>

<p class="update-date">更新日期：2026-01-02</p>
<p class="effective-date">生效日期：2026-01-02</p>
</div>`
}

// 用户协议内容
const USER_AGREEMENT = {
  title: '用户服务协议',
  content: `<div class="protocol-content">
<h2>连氏散养土鸡 用户服务协议</h2>

<p>欢迎使用连氏散养土鸡小程序！</p>

<p>在使用本小程序之前，请您仔细阅读并充分理解本协议。您点击"同意"或实际使用本服务，即表示您已阅读并同意接受本协议的约束。</p>

<h3>1. 服务说明</h3>
<p>1.1 连氏散养土鸡小程序（以下简称"本小程序"）是由监利市连记家禽经营部（个体工商户）开发和运营的生鲜购物平台。</p>

<p>1.2 本小程序向用户提供包括但不限于商品浏览、在线下单、订单管理、物流查询等服务。</p>

<p>1.3 我们保留随时修改、中断或终止部分或全部服务的权利，恕不另行通知。</p>

<h3>2. 用户注册与账号</h3>
<p>2.1 用户使用本小程序服务需要完成注册，并提供真实、准确、完整的个人信息。</p>

<p>2.2 用户注册时需要授权提供手机号码，该号码将用于订单发货、账号登录等必要功能。</p>

<p>2.3 用户应当妥善保管自己的账号信息，对账号下的所有行为承担责任。</p>

<p>2.4 如发现账号被盗用或存在安全隐患，请及时联系客服处理。</p>

<h3>3. 商品与订单</h3>
<p>3.1 本小程序展示的商品信息、价格等以实际页面显示为准。我们会尽力确保信息准确，但不排除因技术原因导致的误差。</p>

<p>3.2 用户下单后，订单即生效。我们将按照订单信息进行配送。</p>

<p>3.3 用户收到商品后，应当及时验收。如有质量问题，请在24小时内联系客服处理。</p>

<p>3.4 特殊商品（如生鲜类）一经售出，非质量问题不支持退换货。</p>

<h3>4. 支付与配送</h3>
<p>4.1 用户可通过微信支付等方式完成订单支付。</p>

<p>4.2 我们将按照用户提供的收货地址进行配送，请确保地址信息准确完整。</p>

<p>4.3 配送时间以实际情况为准，可能因天气、交通等不可抗力因素延迟。</p>

<h3>5. 用户行为规范</h3>
<p>5.1 用户不得利用本小程序从事违法违规活动。</p>

<p>5.2 用户不得恶意下单、恶意评价、恶意投诉等扰乱平台秩序的行为。</p>

<p>5.3 用户发布的评价、留言等内容应当真实、客观，不得包含违法、虚假、侮辱性等不当内容。</p>

<p>5.4 对于违反本协议的用户，我们有权采取警告、限制使用、封禁账号等措施。</p>

<h3>6. 知识产权</h3>
<p>6.1 本小程序的所有内容（包括但不限于文字、图片、logo、程序代码等）的知识产权归监利市连记家禽经营部所有。</p>

<p>6.2 未经授权，任何人不得擅自使用、复制、修改本小程序的任何内容。</p>

<h3>7. 免责声明</h3>
<p>7.1 因不可抗力、系统故障、网络故障等原因导致服务中断或数据丢失，我们不承担责任。</p>

<p>7.2 对于用户因使用本小程序而产生的任何直接或间接损失，我们仅在法律规定的范围内承担责任。</p>

<p>7.3 本小程序可能包含第三方链接或服务，对于第三方的内容和行为，我们不承担责任。</p>

<h3>8. 协议修改</h3>
<p>8.1 我们有权根据需要修改本协议，修改后的协议将在小程序内公布。</p>

<p>8.2 如果您继续使用本小程序，即视为接受修改后的协议。</p>

<h3>9. 联系我们</h3>
<p>如您对本协议有任何疑问或建议，请通过以下方式联系我们：</p>
<p><strong>电话:</strong> 18957185335</p>
<p><strong>经营者:</strong> 监利市连记家禽经营部（个体工商户）</p>

<p class="update-date">更新日期：2026-01-02</p>
<p class="effective-date">生效日期：2026-01-02</p>
</div>`
}

Page({
  data: {
    isStaticContent: false, // 是否为静态内容
    staticContent: null, // 静态内容对象
  },
  onLoad: function (options) {
    if (!options.key) {
      options.key = 'aboutus'
    }
    this.data.key = options.key
    
    // 检查是否为隐私政策或用户协议
    if (options.key === 'ysxy') {
      // 隐私协议
      this.setData({
        isStaticContent: true,
        staticContent: PRIVACY_POLICY
      })
      wx.setNavigationBarTitle({
        title: PRIVACY_POLICY.title,
      })
    } else if (options.key === 'yhxy') {
      // 用户协议
      this.setData({
        isStaticContent: true,
        staticContent: USER_AGREEMENT
      })
      wx.setNavigationBarTitle({
        title: USER_AGREEMENT.title,
      })
    } else {
      // 从后台获取内容
      this.cmsPage()
    }
  },
  onShow: function () {

  },
  async cmsPage() {
    const res = await WXAPI.cmsPage(this.data.key)
    if (res.code == 0) {
      this.setData({
        cmsPageDetail: res.data
      })
      wx.setNavigationBarTitle({
        title: res.data.info.title,
      })
    }
  },
  onShareAppMessage: function() {
    const uid = wx.getStorageSync('uid')
    const title = this.data.isStaticContent 
      ? (wx.getStorageSync('mallName') + ' - ' + this.data.staticContent.title)
      : (wx.getStorageSync('mallName') + ' - ' + this.data.cmsPageDetail.info.title)
    return {
      title: title,
      path: `/subpackages/more/about/index?key=${this.data.key}&inviter_id=${ uid ? uid : ''}`,
      imageUrl: wx.getStorageSync('share_pic')
    }
  },
  onShareTimeline() {
    const uid = wx.getStorageSync('uid')
    const title = this.data.isStaticContent 
      ? (wx.getStorageSync('mallName') + ' - ' + this.data.staticContent.title)
      : (wx.getStorageSync('mallName') + ' - ' + this.data.cmsPageDetail.info.title)
    return {
      title: title,
      query: `key=${this.data.key}&inviter_id=${ uid ? uid : ''}`,
      imageUrl: wx.getStorageSync('share_pic')
    }
  },
})